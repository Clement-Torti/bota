<!DOCTYPE html>
<html lang="es-DO">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bo'ta üó≥Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
<style>
    /* --- VARIABLES & GLOBAL RESET --- */
    :root { --neon-green: #02CB01; --dark-green: #05B602; --hot-pink: #ff007f; --bright-yellow: #ffdd00; --white: #ffffff; --text-dark: #1a1a1a; --card-shadow: 0 15px 35px rgba(0, 0, 0, 0.2); }
    * { box-sizing: border-box; margin: 0; padding: 0; touch-action: manipulation; }
    body { font-family: 'Montserrat', sans-serif; background: repeating-linear-gradient(45deg, var(--neon-green), var(--neon-green) 30px, var(--dark-green) 30px, var(--dark-green) 60px); background-size: 200% 200%; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; overflow: hidden; color: var(--text-dark); animation: moveStripes 25s linear infinite; }
    @keyframes moveStripes { 0% { background-position: 0% 0%; } 100% { background-position: 100% 100%; } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* --- HEADER & LAYOUT --- */
    header { text-align: center; padding: 15px; z-index: 10; position: relative; flex-shrink: 0; }
    header h1 { font-size: 2rem; font-weight: 900; color: var(--white); text-transform: uppercase; text-shadow: 3px 3px 0px var(--hot-pink); font-style: italic; line-height: 1; }
    header span { font-weight: 700; color: var(--text-dark); background: var(--bright-yellow); padding: 2px 10px; transform: rotate(-2deg); display: inline-block; margin-top: 5px; box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2); }
    .app-container { flex: 1; position: relative; display: flex; justify-content: center; align-items: center; width: 100%; max-width: 480px; margin: 0 auto; }

    /* --- CARD STACK LOGIC --- */
    .card-stack { position: relative; width: 90%; height: 65vh; perspective: 1000px; }
    .card { position: absolute; width: 100%; height: 100%; background: var(--white); border-radius: 25px; box-shadow: var(--card-shadow); display: flex; flex-direction: column; overflow: hidden; transition: transform 0.3s ease, opacity 0.3s ease; transform-origin: 50% 100%; border: 4px solid var(--white); }
    .card:nth-last-child(1) { z-index: 3; }
    .card:nth-last-child(2) { z-index: 2; transform: scale(0.95) translateY(15px); opacity: 0.9; }
    .card:nth-last-child(3) { z-index: 1; transform: scale(0.90) translateY(30px); opacity: 0.8; }
    .card:nth-last-child(n+4) { opacity: 0; pointer-events: none; }
    .card-counter { position: absolute; top: 15px; right: 15px; background: rgba(0, 0, 0, 0.5); padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 800; color: white; z-index: 5; pointer-events: none; }

    /* --- CARD INTERIOR CONTENT --- */
    .card-image { width: 100%; height: 45%; object-fit: cover; background: #eee; border-bottom: 5px solid var(--hot-pink); }
    .card-content { padding: 20px; flex: 1; display: flex; flex-direction: column; align-items: center; text-align: center; }
    .category-badge { background: var(--text-dark); color: var(--bright-yellow); padding: 5px 15px; border-radius: 50px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; margin-bottom: 10px; }
    .proposition-text { font-size: 1.2rem; font-weight: 700; line-height: 1.3; margin-bottom: 15px; color: #333; }
    .proposition-description { font-size: 0.85rem; color: #666; margin-bottom: 15px; line-height: 1.4; font-weight: 500; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
    .saber-mas { margin-top: auto; color: var(--hot-pink); text-decoration: none; font-weight: 700; border: 2px solid var(--hot-pink); padding: 8px 20px; border-radius: 20px; font-size: 0.8rem; transition: 0.2s; }
    .saber-mas:hover { background: var(--hot-pink); color: white; }

    /* --- OPINIONS & AVATARS --- */
    .opinion-row { display: flex; align-items: flex-start; margin-bottom: 15px; gap: 12px; text-align: left; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px; }
    .opinion-row:last-child { border-bottom: none; }
    .opinion-avatar { width: 45px; height: 45px; border-radius: 50%; background: #fff; border: 3px solid #ccc; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 0.9rem; flex-shrink: 0; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); overflow: hidden; padding: 0; }
    .opinion-avatar img, .candidate-avatar-res img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .opinion-text { font-size: 0.9rem; color: #333; line-height: 1.4; }

    /* --- CARD DETAILS (SLIDE UP VIEW) --- */
    .card-details { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--white); z-index: 50; padding: 30px; display: flex; flex-direction: column; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1); box-shadow: inset 0 10px 20px -10px rgba(0, 0, 0, 0.1); }
    .card.show-info .card-details { transform: translateY(0); }
    .details-title { font-size: 1.3rem; font-weight: 900; margin-bottom: 15px; color: var(--hot-pink); text-transform: uppercase; line-height: 1.2; text-align: left; }
    .details-text { font-size: 0.95rem; line-height: 1.6; text-align: left; color: #444; overflow-y: auto; flex: 1; padding-bottom: 20px; }
    .btn-close-details { background: var(--text-dark); color: var(--bright-yellow); border: none; padding: 15px; font-weight: 800; text-transform: uppercase; border-radius: 12px; cursor: pointer; margin-top: auto; box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2); }
    .btn-close-details:active { transform: translateY(2px); box-shadow: none; }

    /* --- CONTROLS & OVERLAYS --- */
    .controls { display: flex; justify-content: center; align-items: center; gap: 20px; padding: 20px; padding-bottom: 50px; width: 100%; max-width: 480px; margin: 0 auto; z-index: 20; }
    .btn-action { width: 65px; height: 65px; border-radius: 50%; border: none; font-size: 1.8rem; cursor: pointer; transition: transform 0.1s, box-shadow 0.2s; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 0 rgba(0, 0, 0, 0.2); color: white; }
    .btn-action:active { transform: translateY(4px); box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2); }
    .btn-no { background: var(--hot-pink); }
    .btn-maybe { background: var(--bright-yellow); width: 50px; height: 50px; font-size: 1.5rem; color: var(--text-dark); }
    .btn-yes { background: #00C853; }
    .overlay { position: absolute; top: 40px; font-size: 3rem; font-weight: 900; padding: 5px 20px; border: 6px solid; border-radius: 12px; opacity: 0; z-index: 10; background: rgba(255, 255, 255, 0.8); }
    .overlay-yes { left: 20px; color: #00C853; border-color: #00C853; transform: rotate(-15deg); }
    .overlay-no { right: 20px; color: var(--hot-pink); border-color: var(--hot-pink); transform: rotate(15deg); }
    .overlay-maybe { top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--bright-yellow); border-color: var(--bright-yellow); background: rgba(0, 0, 0, 0.7); font-size: 2rem; }

    /* --- RESULTS VIEW (PODIUM) --- */
    .results-view { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100vh; background: linear-gradient(180deg, var(--neon-green) 0%, #008f36 100%); z-index: 100; flex-direction: column; justify-content: space-between; align-items: center; overflow: hidden; }
    .results-header { margin-top: 40px; text-align: center; color: white; flex-shrink: 0; }
    .podium-container { display: flex; align-items: flex-end; justify-content: center; width: 100%; flex-grow: 1; padding-bottom: 90px; padding-left: 10px; padding-right: 10px; }
    .podium-place { display: flex; flex-direction: column; align-items: center; justify-content: flex-end; margin: 0 4px; width: 30%; height: 100%; position: relative; }
    .place-1 { order: 2; width: 38%; z-index: 10; }
    .place-2 { order: 1; }
    .place-3 { order: 3; }
    .candidate-avatar-res { width: 70px; height: 70px; z-index: 5; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1rem; opacity: 0; transform: translateY(20px); transition: all 0.5s ease; position: relative; }
    .place-1 .candidate-avatar-res { width: 95px; height: 95px; font-size: 1.5rem; border-color: var(--bright-yellow); }
    .podium-bar { width: 100%; background: white; border-radius: 15px 15px 0 0; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; padding-bottom: 10px; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); height: 0; transition: height 1.2s cubic-bezier(0.34, 1.56, 0.64, 1); min-height: 40px; }
    .place-1 .podium-bar { background: var(--bright-yellow); color: var(--text-dark); }
    .place-2 .podium-bar { background: rgba(255, 255, 255, 0.9); }
    .place-3 .podium-bar { background: rgba(255, 255, 255, 0.8); }
    .score-text { font-weight: 900; font-size: 1.4rem; }
    .name-text { font-size: 0.75rem; font-weight: 700; margin-top: 2px; text-align: center; line-height: 1.1; padding: 0 5px; }
    .restart-btn { position: absolute; bottom: 25px; background: var(--hot-pink); color: white; border: none; padding: 15px 50px; border-radius: 50px; font-size: 1rem; font-weight: 800; cursor: pointer; box-shadow: 0 5px 0 #c20061; text-transform: uppercase; z-index: 200; }
    .restart-btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #c20061; }
    .animate-avatar { opacity: 1; transform: translateY(0); }

    /* --- C√âDULA MODAL --- */
    .cedula-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(5px); z-index: 9999; justify-content: center; align-items: center; animation: fadeIn 0.3s ease; }
    .cedula-card { background: var(--white); padding: 30px 20px; width: 90%; max-width: 350px; border-radius: 20px; text-align: center; border: 5px solid var(--bright-yellow); box-shadow: 0 0 30px var(--bright-yellow); transform: scale(0.9); animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; max-height: 85vh; overflow-y: auto; overscroll-behavior: contain; }
    .cedula-card::-webkit-scrollbar { width: 6px; }
    .cedula-card::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
    .cedula-card::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }
    .cedula-card::-webkit-scrollbar-thumb:hover { background: var(--hot-pink); }
    .siren-icon { font-size: 3rem; margin-bottom: 10px; animation: wobble 1s infinite; }
    .cedula-card h2 { text-transform: uppercase; color: var(--text-dark); font-weight: 900; margin-bottom: 10px; transform: rotate(-2deg); }
    .cedula-card p { margin-bottom: 15px; font-size: 0.95rem; line-height: 1.4; }
    #cedulaInput { width: 100%; padding: 15px; font-size: 1.2rem; text-align: center; border: 3px solid #ddd; border-radius: 10px; margin-bottom: 5px; font-family: 'Montserrat', sans-serif; font-weight: 700; outline: none; }
    #cedulaInput:focus { border-color: var(--neon-green); }
    .cedula-card small { display: block; color: #666; margin-bottom: 20px; font-size: 0.75rem; }
    .btn-cedula { background: var(--hot-pink); color: white; border: none; padding: 12px 30px; font-size: 1rem; font-weight: 800; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 0 #c20061; width: 100%; transition: 0.2s; }
    .btn-cedula:active { transform: translateY(2px); box-shadow: 0 2px 0 #c20061; }
    .cedula-feedback { margin-top: 15px; font-weight: 700; min-height: 20px; }
    @keyframes popIn { to { transform: scale(1); } }
    @keyframes wobble { 0%, 100% { transform: rotate(-10deg); } 50% { transform: rotate(10deg); } }

    /* --- PRIVACY & 'WHY' SECTION --- */
    .why-section { text-align: left; font-size: 0.85rem; padding-bottom: 15px; }
    .why-section summary { cursor: pointer; color: #666; font-weight: 700; list-style: none; text-align: center; text-decoration: underline; transition: color 0.2s; }
    .why-section summary:hover { color: var(--hot-pink); }
    .why-section summary::-webkit-details-marker { display: none; }
    .why-content { margin-top: 15px; background: #f9f9f9; padding: 15px; border-radius: 10px; border: 1px solid #eee; font-size: 0.8rem; color: #444; animation: fadeIn 0.3s ease; }
    .why-content p { margin-bottom: 10px; line-height: 1.4; }
    .why-content p:last-child { margin-bottom: 0; }
    .highlight-privacy { background: #e8f5e9; color: #1b5e20; padding: 10px; border-radius: 8px; border: 1px solid #c8e6c9; font-weight: 500; }
    /* --- TUTORIAL OVERLAY STYLES --- */
.tutorial-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.55); /* Dark transparent background */
    z-index: 3000; /* Highest priority */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    transition: opacity 0.4s ease;
    padding-bottom: 80px; /* Space for the button */
}

.tutorial-overlay.hidden {
    opacity: 0;
    pointer-events: none;
}

.tut-content {
    position: relative;
    width: 100%;
    max-width: 400px;
    height: 60vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.tut-row {
    display: flex;
    justify-content: space-between;
    width: 100%;
    padding: 0 20px;
    margin-top: 50px;
}

.tut-zone {
    text-align: center;
    animation: float 2s infinite ease-in-out;
}

.tut-zone h3 {
    font-size: 2rem;
    font-weight: 900;
    text-shadow: 0 2px 0 #000;
    margin: 5px 0;
}

.tut-zone p {
    font-size: 1rem;
    opacity: 0.8;
}

.tut-arrow {
    font-size: 4rem;
    margin-bottom: 10px;
}

/* Specific Colors */
.zone-left { color: var(--hot-pink); transform: rotate(-10deg); }
.zone-right { color: #00C853; transform: rotate(10deg); }
.zone-up { color: var(--bright-yellow); margin-bottom: 20px; }

.btn-got-it {
    margin-top: 50px;
    background: white;
    color: var(--text-dark);
    font-family: 'Montserrat', sans-serif;
    font-size: 1.2rem;
    font-weight: 900;
    padding: 15px 40px;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 5px 0 #ccc;
    text-transform: uppercase;
}

.btn-got-it:active { transform: translateY(3px); box-shadow: 0 2px 0 #ccc; }

@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

</style>
</head>

<body>
    <!-- TUTORIAL OVERLAY -->
 <!-- TUTORIAL OVERLAY -->
<div id="tutorialOverlay" class="tutorial-overlay">
    
    <div class="tut-content">
        <!-- Swipe Up -->
        <div class="tut-zone zone-up">
            <div class="tut-arrow">üëÜ</div>
            <h3>NI IDEA</h3>
            <p>o ver info</p>
        </div>

        <!-- Swipe Left/Right Container -->
        <div class="tut-row">
            <div class="tut-zone zone-left">
                <div class="tut-arrow">üëà</div>
                <h3>NO</h3>
                <p>Nunca</p>
            </div>

            <div class="tut-zone zone-right">
                <div class="tut-arrow">üëâ</div>
                <h3>S√ç</h3>
                <p>De acuerdo</p>
            </div>
        </div>
    </div>

    <button class="btn-got-it" onclick="closeTutorial()">¬°YA ENTEND√ç!</button>
</div>

    <header>
        <h1>Bo'Ta üó≥Ô∏è</h1>
        <span>Presidenciales 2028 üá©üá¥</span>
    </header>

    <div class="app-container">
        <!-- Tarjetas -->
        <div class="card-stack" id="cardStack"></div>

        <!-- Vista Resultados (Podio) -->
        <div class="results-view" id="resultsView">
            <div class="results-header">
                <h2 style="font-size:2rem; font-weight:900; text-shadow: 2px 2px 0 rgba(0,0,0,0.2);">¬°EL RANKING! üèÜ
                </h2>
                <p>Tu match pol√≠tico ideal</p>
            </div>

            <div class="podium-container" id="podiumContainer">
                <!-- Se inyecta con JS -->
            </div>

            <button class="restart-btn" onclick="location.reload()">Jugar otra vez</button>
        </div>
    </div>

    <div class="controls" id="controls">
        <button class="btn-action btn-no" onclick="triggerSwipe('left')">‚úñ</button>
        <button class="btn-action btn-maybe" onclick="triggerSwipe('up')">ü§î</button>
        <button class="btn-action btn-yes" onclick="triggerSwipe('right')">‚ù§</button>
    </div>

    <!-- MODAL DE LA C√âDULA -->
    <div id="cedulaModal" class="cedula-modal">
        <div class="cedula-card">
            <div class="siren-icon">üö®</div>
            <h2>¬°Quieto en primera!</h2>
            <p>
                Contribuye a la voz de los dominicanos <strong>marcando tu c√©dula</strong> ah√≠; e‚Äô <strong>100%
                    an√≥nimo</strong>
            </p>

            <input type="tel" id="cedulaInput" maxlength="11" placeholder="Ej: 40212345678" autocomplete="off">

            <!-- SECCI√ìN NUEVA: WEY, POR QU√â? -->
            <details class="why-section">
                <summary>Wey, ¬øy pa' qu√© quieren eso? ü§î</summary>
                <div class="why-content">
                    <p>
                        <strong>Tranquilo, man√≠n.</strong> Esto no es pa' chivatearte con nadie.
                    </p>
                    <p>
                        Recopilamos esta data para descartar bots y crear <strong>tendencias generales de
                            mercado</strong> para saber qu√© piensa el pueblo realmente sobre estas propuestas.
                    </p>
                    <p class="highlight-privacy">
                        üîí <strong>100% AN√ìNIMO:</strong><br>
                        <strong>NUNCA</strong> guardamos tu nombre asociado a tus respuestas.
                        Tus opiniones se mezclan con las de miles de dominicanos para sacar estad√≠sticas, nadie sabr√°
                        qu√© votaste t√∫.
                    </p>

                    <div style="margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 15px; text-align: center;">
                        <button onclick="skipCedula()"
                            style="background: none; border: none; color: #666; text-decoration: underline; cursor: pointer; font-weight: 700; font-size: 0.9rem;">
                            üëâ Dale pa' lla' sin c√©dula
                        </button>
                    </div>
                </div>
            </details>
            <!-- FIN SECCI√ìN NUEVA -->
            <button class="btn-cedula" onclick="verificarCedula()">Continuamos üá©üá¥</button>
            <p id="cedulaFeedback" class="cedula-feedback"></p>

        </div>
    </div>

    <script>
        // --- DATA ---
        const candidates = [
            {
                id: 'c1',
                name: 'Luis Abinader',
                party: 'PRM',
                color: '#0072CE', // PRM Blue
                score: 0,
                avatar: 'LA',
                description: 'Presidente actual. Promueve reformas institucionales, independencia del Ministerio P√∫blico y alianzas p√∫blico-privadas.'
            },
            {
                id: 'c2',
                name: 'Leonel Fern√°ndez',
                party: 'Fuerza del Pueblo',
                color: '#009900', // FP Green
                score: 0,
                avatar: 'LF',
                description: 'Ex-presidente (3 veces). Enfocado en grandes infraestructuras, critica la inflaci√≥n y la "improvisaci√≥n" del gobierno actual.'
            },
            {
                id: 'c3',
                name: 'Abel Mart√≠nez',
                party: 'PLD',
                color: '#800080', // PLD Purple
                score: 0,
                avatar: 'AM',
                description: 'Ex-alcalde de Santiago. Discurso de "Mano Dura", orden municipal y defensa agresiva de la soberan√≠a nacional.'
            }
        ];


        let propositions = [];

        let currentCardIndex = 0;
        const stackElement = document.getElementById('cardStack');

        // --- WIKIPEDIA IMAGE FETCHER ---
        // This is 100% free, open, and has no rate limits or keys.
        async function fetchWikiImage(keyword) {
            try {
                // 1. We ask Wikipedia for 3 images related to the keyword
                // origin=* fixes CORS issues on localhost
                const url = `https://en.wikipedia.org/w/api.php?action=query&generator=search&gsrsearch=${encodeURIComponent(keyword)}&gsrlimit=3&prop=pageimages&pithumbsize=400&format=json&origin=*`;

                const response = await fetch(url);
                const data = await response.json();

                // 2. Extract pages from the result
                const pages = data.query && data.query.pages ? Object.values(data.query.pages) : [];

                // 3. Filter only results that actually have a thumbnail image
                const validImages = pages.filter(page => page.thumbnail && page.thumbnail.source);

                if (validImages.length > 0) {
                    // 4. Pick a random image from the results to make it dynamic
                    const randomImage = validImages[Math.floor(Math.random() * validImages.length)];
                    return randomImage.thumbnail.source;
                } else {
                    throw new Error("No wiki image found");
                }
            } catch (error) {
                console.error("Wiki load failed", error);
                // Fallback to a solid color text placeholder if Wikipedia fails
                return `https://placehold.co/600x450/EEE/31343C?text=${encodeURIComponent(keyword)}`;
            }
        }

        // --- INIT ---
        // --- NEW HELPER: SHUFFLE FUNCTION ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // --- UPDATED INIT FUNCTION ---
        // --- NEW HELPER: SHUFFLE FUNCTION ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function closeTutorial() {
            const overlay = document.getElementById('tutorialOverlay');
            overlay.classList.add('hidden');
            
            // Optional: remove from DOM after fade out to save memory
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 400);
        }

        // --- UPDATED INIT FUNCTION ---
        async function init() {

            try {
                // 1. Fetch the data from the external file
                const response = await fetch('https://clement-torti.github.io/bota/propositions.html');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // 2. Parse the JSON content
                propositions = await response.json();

            } catch (e) {
                console.error("Error loading propositions:", e);
                document.getElementById('cardStack').innerHTML =
                    '<div style="text-align:center; padding:20px;">Error cargando las preguntas.<br>Verifica el archivo propositions.html</div>';
                return;
            }
            // 1. Shuffle
            shuffleArray(propositions);

            const totalCards = propositions.length;

            // 2. Prepare Data
            const cardsData = [...propositions].reverse().map((prop, index) => {
                const realIndex = propositions.length - 1 - index;
                const displayNum = totalCards - index;
                return { prop, realIndex, displayNum };
            });

            // 3. Build DOM
            for (const item of cardsData) {

                // --- GENERATE CANDIDATE OPINIONS HTML ---
                // We map through the global 'candidates' array to create the rows
                const candidateOpinionsHTML = candidates.map(c => `
            <div class="opinion-row">
                <div class="opinion-avatar" style="border-color: ${c.color}">
                    <img src="${c.avatar}.png" alt="${c.name}">
                </div>
                <div class="opinion-text">
                    <strong style="color:${c.color}">${c.name}</strong><br>
                    ${item.prop.candidateOpinions && item.prop.candidateOpinions[c.id]
                        ? item.prop.candidateOpinions[c.id]
                        : "Sin comentarios espec√≠ficos."}
                </div>
            </div>
        `).join('');

                const card = document.createElement('div');
                card.classList.add('card');
                card.dataset.index = item.realIndex;

                card.innerHTML = `
            <div class="overlay overlay-yes">¬°CLARO!</div>
            <div class="overlay overlay-no">¬°NUNCA!</div>
            <div class="overlay overlay-maybe">NI IDEA</div>
            
            <div class="card-counter">${item.displayNum} / ${totalCards}</div>

            <div class="card-image-wrapper" style="width:100%; height:45%; background:#ddd; position:relative; overflow:hidden;">
                <img src="https://upload.wikimedia.org/wikipedia/commons/b/b1/Loading_icon.gif?20151024034921" 
                        class="card-image" 
                        id="img-${item.realIndex}"
                        style="width:100%; height:100%; object-fit:contain; padding:50px;"
                        alt="Cargando...">
            </div>
            
            <div class="card-content">
                <div class="category-badge">${item.prop.category}</div>
                <div class="proposition-text">${item.prop.text}</div>
                
                <!-- NEW: Description displayed on the card front -->
                <div class="proposition-description">
                    ${item.prop.description}
                </div>
                
                <button class="saber-mas" 
                        onclick="toggleDetails(event, this)" 
                        style="background:none; cursor:pointer;">
                    Saber m√°s +
                </button>
            </div>

            <!-- DETAILS VIEW (BACK) -->
            <div class="card-details">
                <h3 class="details-title" style="margin-bottom:20px; font-size:1.1rem;">
                    ${item.prop.text}
                </h3>
                
                <div class="details-text">
                    <!-- NEW: Injected Candidate Opinions -->
                    ${candidateOpinionsHTML}
                </div>

                <button class="btn-close-details" onclick="toggleDetails(event, this)">
                    Volver a votar
                </button>
            </div>
        `;

                addTouchLogic(card);
                stackElement.appendChild(card);

                fetchWikiImage(item.prop.keyword).then(url => {
                    const img = document.getElementById(`img-${item.realIndex}`);
                    if (img) {
                        img.src = url;
                        img.style.objectFit = "cover";
                        img.style.padding = "0";
                    }
                });
            }
        }

        function addTouchLogic(card) {
            let startX = 0, startY = 0, currentX = 0, currentY = 0, isDragging = false;
            let isMoveEventFired = false; // New flag to ensure we actually moved

            const startDrag = (e) => {
                // 1. Ignore drag if touching a button or scrollable content
                if (e.target.closest('button') || e.target.closest('.details-text')) return;

                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
                startY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;

                // 2. IMPORTANT FIX: Initialize current values to start values
                currentX = startX;
                currentY = startY;

                isDragging = true;
                isMoveEventFired = false; // Reset flag
                card.style.transition = 'none';
            };

            card.addEventListener('touchstart', startDrag);
            card.addEventListener('mousedown', startDrag);

            const moveDrag = (e) => {
                if (!isDragging) return;

                // Mark that a move actually happened
                isMoveEventFired = true;

                currentX = (e.type.includes('mouse') ? e.clientX : e.touches[0].clientX);
                currentY = (e.type.includes('mouse') ? e.clientY : e.touches[0].clientY);

                let diffX = currentX - startX;
                let diffY = currentY - startY;
                let rotation = diffX / 10;

                // Prevent scrolling on mobile ONLY if we are swiping horizontally
                if (e.type === 'touchmove' && Math.abs(diffX) > Math.abs(diffY)) {
                    e.preventDefault();
                }

                if (Math.abs(diffY) > Math.abs(diffX) && diffY < -50) {
                    // Swipe Up logic
                    card.style.transform = `translateY(${diffY}px) scale(${1 - Math.abs(diffY) / 1000})`;
                    card.querySelector('.overlay-maybe').style.opacity = Math.min(Math.abs(diffY) / 150, 1);
                } else {
                    // Side Swipe logic
                    card.style.transform = `translateX(${diffX}px) rotate(${rotation}deg)`;
                    if (diffX > 0) { card.querySelector('.overlay-yes').style.opacity = Math.min(diffX / 100, 1); }
                    else { card.querySelector('.overlay-no').style.opacity = Math.min(Math.abs(diffX) / 100, 1); }
                }
            };

            // Use passive: false to allow e.preventDefault()
            window.addEventListener('touchmove', moveDrag, { passive: false });
            window.addEventListener('mousemove', moveDrag);

            const endDrag = (e) => {
                if (!isDragging) return;
                isDragging = false;

                // 3. If we didn't actually move the finger, it's just a tap. Do nothing.
                if (!isMoveEventFired) {
                    return;
                }

                let diffX = currentX - startX;
                let diffY = currentY - startY;

                card.style.transition = 'transform 0.4s ease';

                // Thresholds to trigger action
                if (diffX > 100) processSwipe('right', card);
                else if (diffX < -100) processSwipe('left', card);
                else if (diffY < -100) processSwipe('up', card);
                else {
                    // Reset if threshold not met
                    card.style.transform = '';
                    card.querySelectorAll('.overlay').forEach(el => el.style.opacity = 0);
                }
            };

            window.addEventListener('touchend', endDrag);
            window.addEventListener('mouseup', endDrag);
        }

        function triggerSwipe(direction) {
            const cards = document.querySelectorAll('.card');
            const topCard = cards[cards.length - 1];
            if (topCard) processSwipe(direction, topCard);
        }

        function processSwipe(direction, card) {
            const index = parseInt(card.dataset.index);
            const prop = propositions[index];

            if (direction !== 'up') {
                const userChoice = direction === 'right' ? 1 : -1;
                candidates.forEach(cand => {
                    const candidateStance = prop.stances[cand.id];
                    if (userChoice === candidateStance) cand.score += 1;
                });
            }

            let transString = '';
            if (direction === 'right') transString = `translateX(${window.innerWidth}px) rotate(30deg)`;
            else if (direction === 'left') transString = `translateX(-${window.innerWidth}px) rotate(-30deg)`;
            else transString = `translateY(-${window.innerHeight}px) scale(0.5)`;

            card.style.transform = transString;
            card.style.opacity = '0';

            setTimeout(() => {
                card.remove();
                currentCardIndex++;
                if (currentCardIndex === 35) {
                    mostrarCedulaModal();
                }
                if (currentCardIndex >= propositions.length) showResults();
            }, 300);
        }

        function showResults() {
            document.getElementById('controls').style.display = 'none';
            document.querySelector('header').style.display = 'none';
            const resultsView = document.getElementById('resultsView');
            resultsView.style.display = 'flex';

            // Ordenamos por puntaje
            candidates.sort((a, b) => b.score - a.score);

            const container = document.getElementById('podiumContainer');
            container.innerHTML = '';

            // El total de puntos posibles es el n√∫mero de cartas respondidas (o total de proposiciones)
            const totalQuestions = propositions.length;

            candidates.slice(0, 3).forEach((cand, index) => {
                // 1. Calcular porcentaje real (0 a 100)
                const rawPercent = totalQuestions > 0 ? (cand.score / totalQuestions) * 100 : 0;
                const displayPercent = Math.round(rawPercent);

                // 2. Calcular altura visual de la barra
                // M√≠nimo 18% (para que quepa el nombre/foto) y M√°ximo 95% (si es 100% match)
                // La f√≥rmula mapea el 0-100% de datos al 18-95% de altura visual
                const visualHeight = 18 + (rawPercent * 0.77);

                // Determinamos el orden visual (centro, izquierda, derecha) para el podio
                // (Esto es solo orden horizontal, no afecta la altura)
                const rank = index + 1;

                const div = document.createElement('div');
                div.className = `podium-place place-${rank}`;

                div.innerHTML = `
            <div class="candidate-avatar-res" style="border-color: ${cand.color}">
                 <img src="${cand.avatar}.png" alt="${cand.name}">
            </div>
            <div class="podium-bar" style="--target-height: ${visualHeight}%;">
                <span class="score-text">${displayPercent}%</span>
                <span class="name-text">${cand.name}</span>
            </div>
        `;
                container.appendChild(div);
            });

            // Animaci√≥n de subida
            setTimeout(() => {
                document.querySelectorAll('.podium-bar').forEach(bar => {
                    bar.style.height = bar.style.getPropertyValue('--target-height');
                });
                document.querySelectorAll('.candidate-avatar-res').forEach((av, i) => {
                    setTimeout(() => av.classList.add('animate-avatar'), i * 200 + 800);
                });
            }, 100);
        }

        // --- L√ìGICA DE LA C√âDULA ---

        function mostrarCedulaModal() {
            const modal = document.getElementById('cedulaModal');
            modal.style.display = 'flex';
            // Desenfocar el input un poco para evitar el teclado inmediato en m√≥viles si molesta, 
            // o enfocarlo si quieres agresividad:
            document.getElementById('cedulaInput').focus();
        }

        function skipCedula() {
            document.getElementById('cedulaModal').style.display = 'none';
        }

        function verificarCedula() {
            const input = document.getElementById('cedulaInput');
            const feedback = document.getElementById('cedulaFeedback');
            const val = input.value.replace(/[^0-9]/g, ''); // Solo n√∫meros

            // Simulaci√≥n "Fake" pero divertida
            if (val.length !== 11) {
                feedback.style.color = 'red';
                feedback.innerText = "‚ùå Esa c√©dula 'ta chueca. Son 11 n√∫meros.";
                input.style.borderColor = 'red';
                return;
            }

            feedback.style.color = '#00C853';
            feedback.innerHTML = "‚úÖ <strong>¬°Confirmado!</strong><br>Usted es dominicano pura cepa.";

            // Efecto visual
            document.querySelector('.cedula-card').style.border = "5px solid #00C853";
            document.querySelector('.siren-icon').innerText = "üá©üá¥";
            document.querySelector('.siren-icon').style.animation = "none";

            setTimeout(() => {
                document.getElementById('cedulaModal').style.display = 'none';
                // El juego contin√∫a solo
            }, 1500);
        }

        // Permitir presionar Enter
        document.getElementById('cedulaInput').addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                verificarCedula();
            }
        });

        // Funci√≥n para mostrar/ocultar la descripci√≥n
        function toggleDetails(event, btnElement) {
            event.stopPropagation(); // Evita que el click afecte el drag de la carta

            // Buscamos la carta padre m√°s cercana
            const card = btnElement.closest('.card');

            if (card) {
                // Alternamos la clase que muestra el CSS transform
                card.classList.toggle('show-info');
            }
        }

        init();
    </script>
</body>

</html>