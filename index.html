<!DOCTYPE html>
<html lang="es-DO">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bo'ta</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="icon" href="favicon.png">

    <style>
        /* --- VARIABLES & GLOBAL RESET --- */
        :root { --neon-green: #F5E9D3; --dark-green: #D8C3A5; --hot-pink: #ff007f; --bright-yellow: #ffdd00; --white: #ffffff; --text-dark: #1a1a1a; --card-shadow: 0 15px 35px rgba(0, 0, 0, 0.2); }
        * { box-sizing: border-box; margin: 0; padding: 0; touch-action: manipulation; }
        body { font-family: 'Montserrat', sans-serif; background: repeating-linear-gradient(45deg, var(--neon-green), var(--neon-green) 30px, var(--dark-green) 30px, var(--dark-green) 60px); background-size: 200% 200%; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; overflow: hidden; color: var(--text-dark); animation: moveStripes 25s linear infinite; }
        @keyframes moveStripes { 0% { background-position: 0% 0%; } 100% { background-position: 100% 100%; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    
        /* --- HEADER & LAYOUT --- */
        header { text-align: center; padding: 15px; z-index: 10; position: relative; flex-shrink: 0; }
        header h1 { font-size: 2rem; font-weight: 900; color: var(--white); text-transform: uppercase; text-shadow: 3px 3px 0px var(--hot-pink); font-style: italic; line-height: 1; }
        header span { font-weight: 700; color: var(--text-dark); background: var(--bright-yellow); padding: 2px 10px; transform: rotate(-2deg); display: inline-block; margin-top: 5px; box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2); }
        .app-container { flex: 1; position: relative; display: flex; justify-content: center; align-items: center; width: 100%; max-width: 480px; margin: 0 auto; }
    
        /* --- CARD STACK LOGIC --- */
        .card-stack { position: relative; width: 90%; height: 65vh; perspective: 1000px; }
        .card { position: absolute; width: 100%; height: 100%; background: var(--white); border-radius: 25px; box-shadow: var(--card-shadow); display: flex; flex-direction: column; overflow: hidden; transition: transform 0.3s ease, opacity 0.3s ease; transform-origin: 50% 100%; border: 4px solid var(--white); }
        .card:nth-last-child(1) { z-index: 3; }
        .card:nth-last-child(2) { z-index: 2; transform: scale(0.95) translateY(15px); opacity: 0.9; }
        .card:nth-last-child(3) { z-index: 1; transform: scale(0.90) translateY(30px); opacity: 0.8; }
        .card:nth-last-child(n+4) { opacity: 0; pointer-events: none; }
        .card-counter { position: absolute; top: 15px; right: 15px; background: rgba(0, 0, 0, 0.5); padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 800; color: white; z-index: 5; pointer-events: none; }
    
        /* --- CARD CONTENT --- */
        .card-image { width: 100%; height: 45%; object-fit: cover; background: #eee; border-bottom: 5px solid var(--hot-pink); }
        .card-content { padding: 20px; flex: 1; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .category-badge { background: var(--text-dark); color: var(--bright-yellow); padding: 5px 15px; border-radius: 50px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; margin-bottom: 10px; }
        .proposition-text { font-size: 1.2rem; font-weight: 700; line-height: 1.3; margin-bottom: 15px; color: #333; }
        .proposition-description { font-size: 0.85rem; color: #666; margin-bottom: 15px; line-height: 1.4; font-weight: 500; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .saber-mas { margin-top: auto; color: var(--hot-pink); text-decoration: none; font-weight: 700; border: 2px solid var(--hot-pink); padding: 8px 20px; border-radius: 20px; font-size: 0.8rem; transition: 0.2s; }
        .saber-mas:hover { background: var(--hot-pink); color: white; }
    
        /* --- OPINIONS (BACK OF CARD) --- */
        .opinion-row { display: flex; align-items: flex-start; margin-bottom: 15px; gap: 12px; text-align: left; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px; }
        .opinion-row:last-child { border-bottom: none; }
        .opinion-avatar { width: 45px; height: 45px; border-radius: 50%; background: #fff; border: 3px solid #ccc; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 0.9rem; flex-shrink: 0; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); overflow: hidden; padding: 0; }
        .opinion-avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .opinion-text { font-size: 0.9rem; color: #333; line-height: 1.4; }
    
        /* --- DETAILS SLIDE UP --- */
        .card-details { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--white); z-index: 50; padding: 30px; display: flex; flex-direction: column; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1); box-shadow: inset 0 10px 20px -10px rgba(0, 0, 0, 0.1); }
        .card.show-info .card-details { transform: translateY(0); }
        .details-title { font-size: 1.3rem; font-weight: 900; margin-bottom: 15px; color: var(--hot-pink); text-transform: uppercase; line-height: 1.2; text-align: left; }
        .details-text { font-size: 0.95rem; line-height: 1.6; text-align: left; color: #444; overflow-y: auto; flex: 1; padding-bottom: 20px; }
        .btn-close-details { background: var(--text-dark); color: var(--bright-yellow); border: none; padding: 15px; font-weight: 800; text-transform: uppercase; border-radius: 12px; cursor: pointer; margin-top: auto; box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2); }
        .btn-close-details:active { transform: translateY(2px); box-shadow: none; }
    
        /* --- CONTROLS & OVERLAYS --- */
        .controls { display: flex; justify-content: center; align-items: center; gap: 20px; padding: 20px; padding-bottom: 50px; width: 100%; max-width: 480px; margin: 0 auto; z-index: 20; }
        .btn-action { width: 65px; height: 65px; border-radius: 50%; border: none; font-size: 1.8rem; cursor: pointer; transition: transform 0.1s, box-shadow 0.2s; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 0 rgba(0, 0, 0, 0.2); color: white; }
        .btn-action:active { transform: translateY(4px); box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2); }
        .btn-no { background: var(--hot-pink); }
        .btn-maybe { background: var(--bright-yellow); width: 50px; height: 50px; font-size: 1.5rem; color: var(--text-dark); }
        .btn-yes { background: #00C853; }
        .overlay { position: absolute; top: 40px; font-size: 3rem; font-weight: 900; padding: 5px 20px; border: 6px solid; border-radius: 12px; opacity: 0; z-index: 10; background: rgba(255, 255, 255, 0.8); }
        .overlay-yes { left: 20px; color: #00C853; border-color: #00C853; transform: rotate(-15deg); }
        .overlay-no { right: 20px; color: var(--hot-pink); border-color: var(--hot-pink); transform: rotate(15deg); }
        .overlay-maybe { top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--bright-yellow); border-color: var(--bright-yellow); background: rgba(0, 0, 0, 0.7); font-size: 2rem; }
    
        /* --- UPDATED RESULTS VIEW (SPLIT SCREEN) --- */
        .results-view { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100vh; background: #f4f4f4; z-index: 100; flex-direction: column; overflow: hidden; }
        /* UPPER HALF: PODIUM */
        .results-upper { height: 45vh; width: 100%; background: linear-gradient(180deg, var(--neon-green) 0%, var(--dark-green) 100%); display: flex; flex-direction: column; flex-shrink: 0; z-index: 10; }
        .results-header { margin-top: 15px; margin-bottom: 5px; color: white; text-align: center; }
        .results-header h2 { font-size: 1.5rem; font-weight: 900; text-shadow: 1px 1px 0 rgba(0,0,0,0.1); }
        .results-header p { font-size: 0.8rem; opacity: 0.9; }
        .podium-container { display: flex; align-items: flex-end; justify-content: center; width: 100%; height: 100%; padding-bottom: 0; padding-left: 10px; padding-right: 10px; }
        .podium-place { display: flex; flex-direction: column; align-items: center; justify-content: flex-end; margin: 0 4px; width: 30%; height: 100%; position: relative; }
        .place-1 { order: 2; width: 38%; z-index: 10; } .place-2 { order: 1; } .place-3 { order: 3; }
        .candidate-avatar-res { width: 50px; height: 50px; z-index: 5; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.9rem; opacity: 0; transform: translateY(20px); transition: all 0.5s ease; position: relative; overflow: hidden; }
        .place-1 .candidate-avatar-res { width: 70px; height: 70px; font-size: 1.2rem; border-color: var(--bright-yellow); }
        .candidate-avatar-res img { width: 100%; height: 100%; object-fit: cover; }
        .podium-bar { width: 100%; background: white; border-radius: 15px 15px 0 0; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; padding-bottom: 10px; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); height: 0; transition: height 1.2s cubic-bezier(0.34, 1.56, 0.64, 1); min-height: 25px; }
        .place-1 .podium-bar { background: var(--bright-yellow); color: var(--text-dark); }
        .place-2 .podium-bar { background: rgba(255, 255, 255, 0.9); }
        .place-3 .podium-bar { background: rgba(255, 255, 255, 0.8); }
        .score-text { font-weight: 900; font-size: 1.2rem; }
        .name-text { font-size: 0.75rem; font-weight: 700; margin-top: 2px; text-align: center; line-height: 1.1; padding: 0 5px; }
        .restart-btn { display: block; width: 100%;  background: var(--hot-pink); color: white; border: none; padding: 15px 50px; border-radius: 50px; font-size: 1rem; font-weight: 800; cursor: pointer; box-shadow: 0 5px 0 #c20061; text-transform: uppercase; z-index: 200; }
        .restart-btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #c20061; }
        .animate-avatar { opacity: 1; transform: translateY(0); }
        /* LOWER HALF: LIST */
        .results-list { flex: 1; overflow-y: auto; padding: 20px; background: #f4f4f4; }
        .res-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: transform 0.2s; overflow: hidden; }
        .res-card-header { display: flex; align-items: center; gap: 15px; cursor: pointer; }
        .res-avatar { width: 50px; height: 50px; border-radius: 50%; border: 3px solid #eee; overflow: hidden; flex-shrink: 0; }
        .res-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .res-info { flex: 1; }
        .res-name { font-weight: 800; font-size: 1rem; color: #333; }
        .res-party { font-size: 0.75rem; color: #666; font-weight: 600; text-transform: uppercase; }
        .res-score { font-size: 1.2rem; font-weight: 900; color: var(--dark-green); }
        .res-stats-bar { display: flex; height: 8px; width: 100%; background: #eee; border-radius: 4px; margin-top: 10px; overflow: hidden; }
        .stat-segment { height: 100%; }
        .stat-match { background: #00C853; }
        .stat-clash { background: var(--hot-pink); }
        .res-stats-text { display: flex; justify-content: space-between; font-size: 0.7rem; color: #888; margin-top: 4px; font-weight: 600; }
        .res-details { max-height: 0; opacity: 0; transition: all 0.3s ease; margin-top: 0; padding-top: 0; border-top: 1px solid transparent; }
        .res-card.expanded .res-details { max-height: 300px; opacity: 1; margin-top: 15px; padding-top: 15px; border-top: 1px solid #f0f0f0; }
        .res-desc { font-size: 0.85rem; color: #555; line-height: 1.4; margin-bottom: 10px; }
        .expand-icon { transition: transform 0.3s; font-size: 0.8rem; color: #ccc; }
        .res-card.expanded .expand-icon { transform: rotate(180deg); }
    
        /* --- C√âDULA MODAL --- */
        .cedula-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(5px); z-index: 9999; justify-content: center; align-items: center; animation: fadeIn 0.3s ease; }
        .cedula-card { background: var(--white); padding: 30px 20px; width: 90%; max-width: 350px; border-radius: 20px; text-align: center; border: 5px solid var(--bright-yellow); box-shadow: 0 0 30px var(--bright-yellow); transform: scale(0.9); animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; max-height: 85vh; overflow-y: auto; overscroll-behavior: contain; }
        .siren-icon { font-size: 3rem; margin-bottom: 10px; animation: wobble 1s infinite; }
        .cedula-card h2 { text-transform: uppercase; color: var(--text-dark); font-weight: 900; margin-bottom: 10px; transform: rotate(-2deg); }
/* --- AGE MODAL STYLES --- */
.age-buttons-container {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 10px;
    width: 100%;
}

.btn-age {
    background: #f8f8f8;
    border: 2px solid #ddd;
    border-radius: 15px;
    padding: 12px 15px;
    cursor: pointer;
    text-align: left;
    transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
}

.btn-age:hover {
    background: #fff;
    border-color: var(--hot-pink);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255, 0, 127, 0.15);
}

.btn-age:active {
    transform: scale(0.98);
}

.age-range {
    font-size: 0.8rem;
    font-weight: 900;
    color: var(--hot-pink); /* Using your neon green var */
    text-transform: uppercase;
    letter-spacing: 1px;
}

.age-slang {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-top: 2px;
}

/* Specific hover effects for fun */
.btn-age:nth-child(1):hover .age-slang { color: var(--hot-pink); }
.btn-age:nth-child(2):hover .age-slang { color: #0072CE; }
.btn-age:nth-child(3):hover .age-slang { color: #800080; }
.btn-age:nth-child(4):hover .age-slang { color: #FFA500; }        .btn-cedula { background: var(--hot-pink); color: white; border: none; padding: 12px 30px; font-size: 1rem; font-weight: 800; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 0 #c20061; width: 100%; transition: 0.2s; margin-top: 10px; }
        .btn-cedula:active { transform: translateY(2px); box-shadow: 0 2px 0 #c20061; }
        .cedula-feedback { margin-top: 15px; font-weight: 700; min-height: 20px; }
        @keyframes popIn { to { transform: scale(1); } }
        @keyframes wobble { 0%, 100% { transform: rotate(-10deg); } 50% { transform: rotate(10deg); } }
    
        /* --- PRIVACY --- */
        .why-section { text-align: left; font-size: 0.85rem; padding-bottom: 15px; }
        .why-section summary { cursor: pointer; color: #666; font-weight: 700; list-style: none; text-align: center; text-decoration: underline; transition: color 0.2s; }
        .why-content { margin-top: 15px; background: #f9f9f9; padding: 15px; border-radius: 10px; border: 1px solid #eee; font-size: 0.8rem; color: #444; animation: fadeIn 0.3s ease; }
        .highlight-privacy { background: #e8f5e9; color: #1b5e20; padding: 10px; border-radius: 8px; border: 1px solid #c8e6c9; font-weight: 500; }
    
        /* --- TUTORIAL OVERLAY --- */
        .tutorial-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.55); z-index: 3000; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; transition: opacity 0.4s ease; padding-bottom: 80px; }
        .tutorial-overlay.hidden { opacity: 0; pointer-events: none; }
        .tut-content { position: relative; width: 100%; max-width: 400px; height: 60vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .tut-row { display: flex; justify-content: space-between; width: 100%; padding: 0 20px; margin-top: 50px; }
        .tut-zone { text-align: center; animation: float 2s infinite ease-in-out; }
        .tut-zone h3 { font-size: 2rem; font-weight: 900; text-shadow: 0 2px 0 #000; margin: 5px 0; }
        .tut-arrow { font-size: 4rem; margin-bottom: 10px; }
        .zone-left { color: var(--hot-pink); transform: rotate(-10deg); } .zone-right { color: #00C853; transform: rotate(10deg); } .zone-up { color: var(--bright-yellow); margin-bottom: 20px; }
        .btn-got-it { margin-top: 50px; background: white; color: var(--text-dark); font-family: 'Montserrat', sans-serif; font-size: 1.2rem; font-weight: 900; padding: 15px 40px; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 5px 0 #ccc; text-transform: uppercase; }
        .btn-got-it:active { transform: translateY(3px); box-shadow: 0 2px 0 #ccc; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        /* --- NEW ARGUMENTS STYLES --- */
        .args-container { width: 100%; margin: 10px 0; display: flex; flex-direction: column; gap: 8px; }
        .arg-row { display: flex; align-items: flex-start; gap: 10px; font-size: 0.8rem; text-align: left; background: #fafafa; padding: 8px; border-radius: 8px; border: 1px solid #eee; }
        .arg-icon { font-size: 1.1rem; flex-shrink: 0; line-height: 1; }
        .arg-content { flex: 1; }
        .arg-label { display: block; font-weight: 800; font-size: 0.7rem; text-transform: uppercase; margin-bottom: 2px; }
        .txt-green { color: #00C853; }
        .txt-red { color: var(--hot-pink); }
    </style>
</head>

<body>
    <!-- TUTORIAL OVERLAY -->
 <!-- TUTORIAL OVERLAY -->
<div id="tutorialOverlay" class="tutorial-overlay">
    
    <div class="tut-content">
        <!-- Swipe Up -->
        <div class="tut-zone zone-up">
            <div class="tut-arrow">üëÜ</div>
            <h3>NI IDEA</h3>
            <p>o ver info</p>
        </div>

        <!-- Swipe Left/Right Container -->
        <div class="tut-row">
            <div class="tut-zone zone-left">
                <div class="tut-arrow">üëà</div>
                <h3>NO</h3>
                <p>Nunca</p>
            </div>

            <div class="tut-zone zone-right">
                <div class="tut-arrow">üëâ</div>
                <h3>S√ç</h3>
                <p>De acuerdo</p>
            </div>
        </div>
    </div>

    <button class="btn-got-it" onclick="closeTutorial()">¬°YA ENTEND√ç!</button>
</div>

    <header>
        <h1>Bo'Ta üó≥Ô∏è</h1>
        <span>Presidenciales 2028 üá©üá¥</span>
    </header>

    <div class="app-container">
        <!-- Tarjetas -->
        <div class="card-stack" id="cardStack"></div>

        <!-- Vista Resultados (Podio) -->
        <div class="results-view" id="resultsView">
            
            <!-- UPPER HALF: PODIUM -->
            <div class="results-upper">
                <div class="results-header">
                    <h2 style="font-weight:900; text-shadow: 1px 1px 0 rgba(0,0,0,0.1);">TOP 3 üèÜ</h2>
                    <p>Tu afinidad pol√≠tica</p>
                </div>
                <div class="podium-container" id="podiumContainer">
                    <!-- Se inyecta con JS -->
                </div>
            </div>

            <!-- LOWER HALF: LIST -->
            <div class="results-list" id="resultsList">
                <!-- Candidate Cards Injected Here -->
                <!-- Restart Button appended at end -->
            </div>
        </div>
    </div>

    <div class="controls" id="controls">
        <button class="btn-action btn-no" onclick="triggerSwipe('left')">‚úñ</button>
        <button class="btn-action btn-maybe" onclick="triggerSwipe('up')">ü§î</button>
        <button class="btn-action btn-yes" onclick="triggerSwipe('right')">‚ù§</button>
    </div>

    <!-- MODAL DE LA C√âDULA -->
    <div id="cedulaModal" class="cedula-modal">
        <div class="cedula-card">
            <div class="siren-icon">üéÇ</div>
            <h2>¬øCu√°l es tu Coro?</h2>
            <p>
                Selecciona tu grupo pa' saber qu√© piensa cada generaci√≥n. <br>
                <strong>(Cero chivateo, es 100% an√≥nimo)</strong>
            </p>

            <div class="age-buttons-container">
                <button class="btn-age" onclick="selectAge('18-25')">
                    <span class="age-range">18 - 25</span>
                    <span class="age-slang">Gen Z (La Pampara üî•)</span>
                </button>
                
                <button class="btn-age" onclick="selectAge('26-40')">
                    <span class="age-range">26 - 40</span>
                    <span class="age-slang">Millennial (Cogi√©ndolo Variado üç∫)</span>
                </button>
                
                <button class="btn-age" onclick="selectAge('41-60')">
                    <span class="age-range">41 - 60</span>
                    <span class="age-slang">Gen X (Los Jefes üëî)</span>
                </button>
                
                <button class="btn-age" onclick="selectAge('60+')">
                    <span class="age-range">60 o m√°s</span>
                    <span class="age-slang">Los Robles (Respeto ü´°)</span>
                </button>
            </div>

            <!-- UPDATED PRIVACY SECTION -->
            <details class="why-section" style="margin-top: 15px;">
                <summary>Wey, ¬øy pa' qu√© quieren saber? ü§î</summary>
                <div class="why-content">
                    <p>
                        <strong>Tranquilo, man√≠n.</strong>
                    </p>
                    <p>
                        Queremos saber si los j√≥venes piensan igual que los do√±os. As√≠ sacamos estad√≠sticas tipo: 
                        <em>"El 80% de la Gen Z quiere tal cosa"</em>.
                    </p>
                    <p class="highlight-privacy">
                        üîí <strong>DATA AN√ìNIMA:</strong><br>
                        No guardamos nombres. Solo tu opini√≥n y tu rango de edad.
                    </p>
                </div>
            </details>
        </div>
    </div>

    <script>
        // --- DATA ---
        const candidates = [
            {
                "id": "c1",
                "name": "Luis Abinader",
                "party": "PRM",
                "color": "#0072CE",
                "score": 0,
                "matches": 0,
                "clashes": 0,
                "avatar": "LA",
                "description": "Presidente actual. Centro-derecha liberal. Promueve alianzas p√∫blico-privadas, 'Ministerio P√∫blico Independiente' y control fronterizo tecnol√≥gico. Criticado por endeudamiento y reformas fiscales."
            },
            {
                "id": "c2",
                "name": "Leonel Fern√°ndez",
                "party": "Fuerza del Pueblo",
                "color": "#009900",
                "score": 0,
                "matches": 0,
                "clashes": 0,
                "avatar": "LF",
                "description": "Ex-presidente (3 veces). Centro/Derecha. Enfocado en grandes infraestructuras y modernizaci√≥n institucional. Se opone a reformas fiscales bruscas y critica la 'improvisaci√≥n' del gobierno."
            },
            {
                "id": "c3",
                "name": "Abel Mart√≠nez",
                "party": "PLD",
                "color": "#800080",
                "score": 0,
                "matches": 0,
                "clashes": 0,
                "avatar": "AM",
                "description": "Ex-alcalde de Santiago. Derecha conservadora. Discurso de 'Orden' y 'Mano Dura' contra la inmigraci√≥n ilegal y la delincuencia. Defiende la obra de gobierno de su partido."
            },
            {
                "id": "c4",
                "name": "Roque Espaillat",
                "party": "PED / El Cobrador",
                "color": "#FFCC00",
                "score": 0,
                "matches": 0,
                "clashes": 0,
                "avatar": "RE",
                "description": "Populista de Derecha / Nacionalista. Anti-sistema, promete 'c√°rcel para los corruptos', militarizaci√≥n total de la frontera y mano dura estilo Bukele. En contra de impuestos y partidos tradicionales."
            },
            {
                "id": "c5",
                "name": "Virginia Antares",
                "party": "Opci√≥n Democr√°tica",
                "color": "#E3A330",
                "score": 0,
                "matches": 0,
                "clashes": 0,
                "avatar": "VA",
                "description": "Progresista / Izquierda Moderna. Feminista y ecologista. A favor de las 3 causales, reforma fiscal a los ricos, desprivatizaci√≥n de servicios y derechos laborales. En contra del muro y mano dura."
            }
            ];


        let propositions = [];

        let currentCardIndex = 0;
        const stackElement = document.getElementById('cardStack');

        // --- WIKIPEDIA IMAGE FETCHER ---
        // This is 100% free, open, and has no rate limits or keys.
        async function fetchWikiImage(keyword) {
            try {
                // 1. We ask Wikipedia for 3 images related to the keyword
                // origin=* fixes CORS issues on localhost
                const url = `https://en.wikipedia.org/w/api.php?action=query&generator=search&gsrsearch=${encodeURIComponent(keyword)}&gsrlimit=3&prop=pageimages&pithumbsize=400&format=json&origin=*`;

                const response = await fetch(url);
                const data = await response.json();

                // 2. Extract pages from the result
                const pages = data.query && data.query.pages ? Object.values(data.query.pages) : [];

                // 3. Filter only results that actually have a thumbnail image
                const validImages = pages.filter(page => page.thumbnail && page.thumbnail.source);

                if (validImages.length > 0) {
                    // 4. Pick a random image from the results to make it dynamic
                    const randomImage = validImages[Math.floor(Math.random() * validImages.length)];
                    return randomImage.thumbnail.source;
                } else {
                    throw new Error("No wiki image found");
                }
            } catch (error) {
                console.error("Wiki load failed", error);
                // Fallback to a solid color text placeholder if Wikipedia fails
                return `https://placehold.co/600x450/EEE/31343C?text=${encodeURIComponent(keyword)}`;
            }
        }

        // --- INIT ---
        // --- NEW HELPER: SHUFFLE FUNCTION ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // --- UPDATED INIT FUNCTION ---
        // --- NEW HELPER: SHUFFLE FUNCTION ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function closeTutorial() {
            const overlay = document.getElementById('tutorialOverlay');
            overlay.classList.add('hidden');
            
            // Optional: remove from DOM after fade out to save memory
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 400);
        }

        // --- UPDATED INIT FUNCTION ---
        async function init() {
            try {
                // 1. Fetch the data
                const response = await fetch('https://clement-torti.github.io/bota/propositions.html');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // 2. Parse and FILTER by 'enable' property
                const allData = await response.json();
                propositions = allData.filter(p => p.enable === true);

            } catch (e) {
                console.error("Error loading propositions:", e);
                document.getElementById('cardStack').innerHTML =
                    '<div style="text-align:center; padding:20px;">Error cargando las preguntas.<br>Verifica el archivo propositions.html</div>';
                return;
            }

            // 3. Shuffle
            shuffleArray(propositions);

            const totalCards = propositions.length;

            // 4. Prepare Data
            const cardsData = [...propositions].reverse().map((prop, index) => {
                const realIndex = propositions.length - 1 - index;
                const displayNum = totalCards - index;
                return { prop, realIndex, displayNum };
            });

            // 5. Build DOM
            for (const item of cardsData) {

                // Generate Candidate Opinions HTML (Back of card)
                const candidateOpinionsHTML = candidates.map(c => `
                    <div class="opinion-row">
                        <div class="opinion-avatar" style="border-color: ${c.color}">
                            <img src="${c.avatar}.png" alt="${c.name}">
                        </div>
                        <div class="opinion-text">
                            <strong style="color:${c.color}">${c.name}</strong><br>
                            ${item.prop.candidateOpinions && item.prop.candidateOpinions[c.id]
                                ? item.prop.candidateOpinions[c.id]
                                : "Sin comentarios espec√≠ficos."}
                        </div>
                    </div>
                `).join('');

                const card = document.createElement('div');
                card.classList.add('card');
                card.dataset.index = item.realIndex;

                card.innerHTML = `
                    <div class="overlay overlay-yes">¬°CLARO!</div>
                    <div class="overlay overlay-no">¬°NUNCA!</div>
                    <div class="overlay overlay-maybe">NI IDEA</div>
                    
                    <div class="card-counter">${item.displayNum} / ${totalCards}</div>

                    <div class="card-image-wrapper" style="width:100%; height:45%; background:#ddd; position:relative; overflow:hidden;">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/b/b1/Loading_icon.gif?20151024034921" 
                                class="card-image" 
                                id="img-${item.realIndex}"
                                style="width:100%; height:100%; object-fit:contain; padding:50px;"
                                alt="Cargando...">
                    </div>
                    
                    <div class="card-content">
                        <div class="category-badge">${item.prop.category}</div>
                        <div class="proposition-text">${item.prop.text}</div>
                        
                        <!-- Description -->
                        <div class="proposition-description" style="margin-bottom:10px;">
                            ${item.prop.description}
                        </div>

                        <!-- NEW: For/Against Arguments -->
                        <div class="args-container">
                            <div class="arg-row">
                                <div class="arg-icon">üëç</div>
                                <div class="arg-content">
                                    <span class="arg-label txt-green">A Favor</span>
                                    ${item.prop.for}
                                </div>
                            </div>
                            <div class="arg-row">
                                <div class="arg-icon">üëé</div>
                                <div class="arg-content">
                                    <span class="arg-label txt-red">En Contra</span>
                                    ${item.prop.against}
                                </div>
                            </div>
                        </div>
                        
                        <button class="saber-mas" 
                                onclick="toggleDetails(event, this)" 
                                style="background:none; cursor:pointer; margin-top:auto;">
                            Saber m√°s +
                        </button>
                    </div>

                    <!-- DETAILS VIEW (BACK) -->
                    <div class="card-details">
                        <h3 class="details-title" style="margin-bottom:20px; font-size:1.1rem;">
                            ${item.prop.text}
                        </h3>
                        
                        <div class="details-text">
                            ${candidateOpinionsHTML}
                        </div>

                        <button class="btn-close-details" onclick="toggleDetails(event, this)">
                            Volver a votar
                        </button>
                    </div>
                `;

                addTouchLogic(card);
                stackElement.appendChild(card);

                fetchWikiImage(item.prop.keyword).then(url => {
                    const img = document.getElementById(`img-${item.realIndex}`);
                    if (img) {
                        img.src = url;
                        img.style.objectFit = "cover";
                        img.style.padding = "0";
                    }
                });
            }
        }

        function addTouchLogic(card) {
            let startX = 0, startY = 0, currentX = 0, currentY = 0, isDragging = false;
            let isMoveEventFired = false; // New flag to ensure we actually moved

            const startDrag = (e) => {
                // 1. Ignore drag if touching a button or scrollable content
                if (e.target.closest('button') || e.target.closest('.details-text')) return;

                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
                startY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;

                // 2. IMPORTANT FIX: Initialize current values to start values
                currentX = startX;
                currentY = startY;

                isDragging = true;
                isMoveEventFired = false; // Reset flag
                card.style.transition = 'none';
            };

            card.addEventListener('touchstart', startDrag);
            card.addEventListener('mousedown', startDrag);

            const moveDrag = (e) => {
                if (!isDragging) return;

                // Mark that a move actually happened
                isMoveEventFired = true;

                currentX = (e.type.includes('mouse') ? e.clientX : e.touches[0].clientX);
                currentY = (e.type.includes('mouse') ? e.clientY : e.touches[0].clientY);

                let diffX = currentX - startX;
                let diffY = currentY - startY;
                let rotation = diffX / 10;

                // Prevent scrolling on mobile ONLY if we are swiping horizontally
                if (e.type === 'touchmove' && Math.abs(diffX) > Math.abs(diffY)) {
                    e.preventDefault();
                }

                if (Math.abs(diffY) > Math.abs(diffX) && diffY < -50) {
                    // Swipe Up logic
                    card.style.transform = `translateY(${diffY}px) scale(${1 - Math.abs(diffY) / 1000})`;
                    card.querySelector('.overlay-maybe').style.opacity = Math.min(Math.abs(diffY) / 150, 1);
                } else {
                    // Side Swipe logic
                    card.style.transform = `translateX(${diffX}px) rotate(${rotation}deg)`;
                    if (diffX > 0) { card.querySelector('.overlay-yes').style.opacity = Math.min(diffX / 100, 1); }
                    else { card.querySelector('.overlay-no').style.opacity = Math.min(Math.abs(diffX) / 100, 1); }
                }
            };

            // Use passive: false to allow e.preventDefault()
            window.addEventListener('touchmove', moveDrag, { passive: false });
            window.addEventListener('mousemove', moveDrag);

            const endDrag = (e) => {
                if (!isDragging) return;
                isDragging = false;

                // 3. If we didn't actually move the finger, it's just a tap. Do nothing.
                if (!isMoveEventFired) {
                    return;
                }

                let diffX = currentX - startX;
                let diffY = currentY - startY;

                card.style.transition = 'transform 0.4s ease';

                // Thresholds to trigger action
                if (diffX > 100) processSwipe('right', card);
                else if (diffX < -100) processSwipe('left', card);
                else if (diffY < -100) processSwipe('up', card);
                else {
                    // Reset if threshold not met
                    card.style.transform = '';
                    card.querySelectorAll('.overlay').forEach(el => el.style.opacity = 0);
                }
            };

            window.addEventListener('touchend', endDrag);
            window.addEventListener('mouseup', endDrag);
        }

        function triggerSwipe(direction) {
            const cards = document.querySelectorAll('.card');
            const topCard = cards[cards.length - 1];
            if (topCard) processSwipe(direction, topCard);
        }

        function processSwipe(direction, card) {
            const index = parseInt(card.dataset.index);
            const prop = propositions[index];

            if (direction !== 'up') {
                const userChoice = direction === 'right' ? 1 : -1;
                
                candidates.forEach(cand => {
                    const candidateStance = prop.stances[cand.id];
                    
                    // Check match vs clash
                    if (userChoice === candidateStance) {
                        cand.score += 1; // General Score
                        cand.matches += 1; // Specific Match Count
                    } else {
                        // If user said Yes and candidate said No (or vice versa)
                        cand.clashes += 1;
                    }
                });
            }

            let transString = '';
            if (direction === 'right') transString = `translateX(${window.innerWidth}px) rotate(30deg)`;
            else if (direction === 'left') transString = `translateX(-${window.innerWidth}px) rotate(-30deg)`;
            else transString = `translateY(-${window.innerHeight}px) scale(0.5)`;

            card.style.transform = transString;
            card.style.opacity = '0';

            setTimeout(() => {
                card.remove();
                currentCardIndex++;
                if (currentCardIndex === 35) {
                    mostrarCedulaModal();
                }
                if (currentCardIndex >= propositions.length) showResults();
            }, 300);
        }

        function showResults() {
            document.getElementById('controls').style.display = 'none';
            document.querySelector('header').style.display = 'none';
            const resultsView = document.getElementById('resultsView');
            resultsView.style.display = 'flex';

            // 1. Sort by Score
            candidates.sort((a, b) => b.score - a.score);

            // --- RENDER PODIUM (Top 3) ---
            const podiumContainer = document.getElementById('podiumContainer');
            podiumContainer.innerHTML = '';
            const totalQuestions = propositions.length;

            candidates.slice(0, 3).forEach((cand, index) => {
                const rawPercent = totalQuestions > 0 ? (cand.score / totalQuestions) * 100 : 0;
                const displayPercent = Math.round(rawPercent);
                // Adjusted visual height for half-screen (max 80%)
                const visualHeight = 20 + (rawPercent * 0.6); 
                const rank = index + 1;

                const div = document.createElement('div');
                div.className = `podium-place place-${rank}`;
                div.innerHTML = `
                    <div class="candidate-avatar-res" style="border-color: ${cand.color}">
                        <img src="${cand.avatar}.png" alt="${cand.name}">
                    </div>
                    <div class="podium-bar" style="--target-height: ${visualHeight}%;">
                        <span class="score-text">${displayPercent}%</span>
                        <span class="name-text">${cand.name}</span>
                    </div>
                `;
                podiumContainer.appendChild(div);
            });

            // --- RENDER LIST (All Candidates) ---
            const listContainer = document.getElementById('resultsList');
            listContainer.innerHTML = ''; // Clear previous

            candidates.forEach(cand => {
                // Calculate percentages for bar
                const totalInteractions = cand.matches + cand.clashes; // Excludes "Maybe"
                const matchPct = totalInteractions > 0 ? (cand.matches / totalQuestions) * 100 : 0;
                const clashPct = totalInteractions > 0 ? (cand.clashes / totalQuestions) * 100 : 0;
                
                const cardDiv = document.createElement('div');
                cardDiv.className = 'res-card';
                cardDiv.onclick = function() { toggleResultCard(this); };

                cardDiv.innerHTML = `
                    <div class="res-card-header">
                        <div class="res-avatar" style="border-color: ${cand.color}">
                            <img src="${cand.avatar}.png" alt="${cand.name}">
                        </div>
                        <div class="res-info">
                            <div class="res-name">${cand.name}</div>
                            <div class="res-party" style="color:${cand.color}">${cand.party}</div>
                            
                            <!-- Stats Bar -->
                            <div class="res-stats-bar">
                                <div class="stat-segment stat-match" style="width: ${matchPct}%"></div>
                                <div class="stat-segment stat-clash" style="width: ${clashPct}%"></div>
                            </div>
                            <div class="res-stats-text">
                                <span>‚úÖ ${cand.matches} Acuerdos</span>
                                <span>‚ùå ${cand.clashes} Desacuerdos</span>
                            </div>
                        </div>
                        <div class="res-score">${Math.round(matchPct)}%</div>
                        <div class="expand-icon">‚ñº</div>
                    </div>
                    
                    <div class="res-details">
                        <div class="res-desc">${cand.description}</div>
                        <!-- You could add more detailed stats here later -->
                    </div>
                `;
                listContainer.appendChild(cardDiv);
            });

            // Append Restart Button at the bottom of list
            const restartBtn = document.createElement('button');
            restartBtn.className = 'restart-btn';
            restartBtn.innerText = 'Jugar otra vez';
            restartBtn.onclick = () => location.reload();
            listContainer.appendChild(restartBtn);

            // Animations
            setTimeout(() => {
                document.querySelectorAll('.podium-bar').forEach(bar => {
                    bar.style.height = bar.style.getPropertyValue('--target-height');
                });
                document.querySelectorAll('.candidate-avatar-res').forEach((av, i) => {
                    setTimeout(() => av.classList.add('animate-avatar'), i * 200 + 500);
                });
            }, 100);
        }

        // Helper to expand cards
        function toggleResultCard(cardElement) {
            cardElement.classList.toggle('expanded');
        }

        // --- L√ìGICA DE LA C√âDULA ---

        function mostrarCedulaModal() {
            const modal = document.getElementById('cedulaModal');
            modal.style.display = 'flex';
            // Desenfocar el input un poco para evitar el teclado inmediato en m√≥viles si molesta, 
            // o enfocarlo si quieres agresividad:
            document.getElementById('cedulaInput').focus();
        }

        function selectAge(group) {
            // 1. Visual feedback (User clicked)
            console.log("Grupo seleccionado:", group);

            // 2. You could save this to a variable or localStorage if needed
            // localStorage.setItem('voter_age_group', group);

            // 3. Close Modal with animation
            const modalContent = document.querySelector('.cedula-card');
            modalContent.innerHTML = `
                <div style="padding:40px 0;">
                    <div style="font-size:4rem; animation: popIn 0.5s;">üá©üá¥</div>
                    <h2 style="margin-top:20px; color:var(--dark-green);">¬°Gracias!</h2>
                    <p>Seguimo'...</p>
                </div>
            `;

            setTimeout(() => {
                document.getElementById('cedulaModal').style.display = 'none';
                // Logic to continue or finish logic if this was the last step
                // In the original code, this modal appeared *before* showing results? 
                // If so, just let the flow continue.
            }, 1200);
        }

        

        // Permitir presionar Enter
 
        // Funci√≥n para mostrar/ocultar la descripci√≥n
        function toggleDetails(event, btnElement) {
            event.stopPropagation(); // Evita que el click afecte el drag de la carta

            // Buscamos la carta padre m√°s cercana
            const card = btnElement.closest('.card');

            if (card) {
                // Alternamos la clase que muestra el CSS transform
                card.classList.toggle('show-info');
            }
        }

        init();
    </script>
</body>

</html>